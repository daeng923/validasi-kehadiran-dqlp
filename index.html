<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Validasi Kehadiran</title>

<style>
:root{
  --primary:#0f5132;
  --bg:#f4f7f6;
  --card:#ffffff;
  --text:#333;
  --muted:#777;
}

body{
  margin:0;
  font-family:Segoe UI, Arial, sans-serif;
  background:var(--bg);
  padding:20px;
}

.card{
  max-width:420px;
  margin:auto;
  background:var(--card);
  border-radius:14px;
  padding:24px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
}

h2{
  margin-top:0;
  color:var(--primary);
}

input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}

button{
  width:100%;
  margin-top:16px;
  padding:12px;
  border:none;
  border-radius:8px;
  background:var(--primary);
  color:#fff;
  font-size:15px;
  cursor:pointer;
}

button:disabled{
  background:#999;
}

.loading{
  display:none;
  text-align:center;
  margin-top:15px;
  color:var(--muted);
}

.success{
  text-align:center;
}

.success h3{
  color:var(--primary);
}

.small{
  font-size:13px;
  color:var(--muted);
  margin-top:10px;
}
</style>
</head>

<body>

<div class="card">

  <!-- ================= LOGIN PAGE ================= -->
  <div id="page-login">
    <h2>Validasi Kehadiran</h2>

    <input type="email" id="email" placeholder="Email aktif">
    <input type="text" id="token" placeholder="Token dari pengajar">

    <button id="btnValidasi" onclick="validasi()">Validasi</button>

    <div class="loading" id="loading">
      Memproses validasi...
    </div>
  </div>

  <!-- ================= SUCCESS PAGE ================= -->
  <div id="page-valid" class="success" style="display:none">
    <h3>Validasi Berhasil âœ…</h3>
    <p id="namaUser"></p>
    <p class="small">Kehadiran Anda telah tercatat.</p>

    <button onclick="resetSession()">Keluar</button>
  </div>

</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyATVh1utkwPSW9MDGUco3b-uLUeL0cqEI52IuEW2RCD0idcEtS7coC7_U_DQUoz2PX/exec";

/* ================= VALIDASI ================= */
function validasi(){
  const email = document.getElementById("email").value.trim();
  const token = document.getElementById("token").value.trim();

  if(!email || !token){
    alert("Email dan token wajib diisi.");
    return;
  }

  document.getElementById("btnValidasi").disabled = true;
  document.getElementById("loading").style.display = "block";

  fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({email, token})
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.status === "success"){
      // SIMPAN STATUS
      sessionStorage.setItem("validated","true");
      sessionStorage.setItem("nama",data.nama || "");
      sessionStorage.setItem("email",email);

      tampilkanHalamanValid();
    }else{
      alert(data.message || "Token tidak valid atau sudah digunakan.");
      document.getElementById("btnValidasi").disabled = false;
    }
  })
  .catch(()=>{
    alert("Gagal terhubung ke server.");
    document.getElementById("btnValidasi").disabled = false;
  })
  .finally(()=>{
    document.getElementById("loading").style.display = "none";
  });
}

/* ================= TAMPILAN ================= */
function tampilkanHalamanValid(){
  document.getElementById("page-login").style.display = "none";
  document.getElementById("page-valid").style.display = "block";
  document.getElementById("namaUser").innerText =
    "Nama: " + (sessionStorage.getItem("nama") || "-");
}

/* ================= RESET ================= */
function resetSession(){
  sessionStorage.clear();
  location.reload();
}

/* ================= AUTO CHECK (ANTI REFRESH) ================= */
document.addEventListener("DOMContentLoaded",()=>{
  if(sessionStorage.getItem("validated")==="true"){
    tampilkanHalamanValid();
  }
});
</script>

</body>
</html>
